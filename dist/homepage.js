!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("homepage",[],t):"object"==typeof exports?exports.homepage=t():e.homepage=t()}(this,(()=>(()=>{"use strict";const e=new class{authenticate(e="/",t="/login"){const o=localStorage.getItem("authToken");o?fetch("https://xrux-avyn-v7a8.n7d.xano.io/api:7eX5OyVa/auth/me",{method:"GET",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}}).then((e=>e.json())).then((o=>{if("ERROR_CODE_UNAUTHORIZED"===o.code)localStorage.removeItem("authToken"),window.location.pathname!==t&&(window.location.href=t);else{if("/clients"===window.location.pathname)return;window.location.pathname!==e&&(window.location.href=e)}})).catch((e=>{console.error("Error:",e)})):window.location.pathname!==t&&(window.location.href=t)}logIn(e){fetch("https://xrux-avyn-v7a8.n7d.xano.io/api:7eX5OyVa/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{if(e.authToken)localStorage.setItem("authToken",e.authToken),0===e.clients_length?window.location.href="/clients":window.location.href="/";else{const e=document.querySelector(".error-message"),t=document.querySelectorAll(".login-input");e.classList.remove("hidden"),t.forEach((e=>{e.classList.add("invalid")}))}})).catch((e=>{console.error("Error:",e)}))}logOut(){localStorage.removeItem("authToken"),window.location.href="/login"}toggleUserPassVisibility(e,t,o){"password"===e.type?(e.type="text",t.style.display="block",o.style.display="none"):(e.type="password",t.style.display="none",o.style.display="block")}},t=new class{constructor(){this.activeTool=null,this.deleteMode=null,this.editMode=!1,this.disableActiveTool=this.disableActiveTool.bind(this),this.drawElement=this.drawElement.bind(this),this.deleteElement=this.deleteElement.bind(this)}loadMap(){window.map=L.map("map",{zoomControl:!1}).setView([37.8,-96],4),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(window.map),window.drawnItems=new L.FeatureGroup,window.nonEditableItems=L.featureGroup().addTo(window.map),window.map.addLayer(window.drawnItems);const e=new L.Control.Draw({edit:!1,draw:{polygon:!1,rectangle:!1,circle:!1,marker:!1,polyline:!1,circlemarker:!1}});window.map.addControl(e)}disableActiveTool(){this.activeTool&&(this.activeTool.disable(),this.activeTool=null),this.deleteMode&&(this.deleteMode.disable(),this.deleteMode=null),this.editMode&&(window.drawnItems.eachLayer((function(e){e.editing&&e.editing.disable()})),this.editMode=!1),document.querySelector(".town-radius__dropdown").classList.add("hidden")}loadGeojson(e){L.geoJSON(e,{onEachFeature:function(e,t){e.properties&&!1===e.properties.editable?(window.nonEditableItems.addLayer(t),updateButtonState()):(window.drawnItems.addLayer(t),updateButtonState())}}).addTo(window.map)}deleteElement(){this.disableActiveTool(),this.deleteMode=new L.EditToolbar.Delete(window.map,{featureGroup:window.drawnItems}),this.deleteMode.enable(),window.drawnItems.eachLayer((function(e){e.on("click",(function(){removeLayer(e)}))})),window.nonEditableItems.eachLayer((function(e){e.on("click",(function(){removeLayer(e)}))}))}drawElement(e){const t=e.layer;window.drawnItems.addLayer(t),updateButtonState(),"polygon"===e.layerType?L.DomUtil.addClass(t._path,"custom-polygon"):"rectangle"===e.layerType?L.DomUtil.addClass(t._path,"custom-rectangle"):"circle"===e.layerType&&L.DomUtil.addClass(t._path,"custom-circle"),document.querySelectorAll(".tool-wrapper").forEach((function(e){e.classList.remove("active")}))}edit(){this.editMode?(window.drawnItems.eachLayer((function(e){e.editing&&e.editing.disable()})),this.editMode=!1):(window.drawnItems.eachLayer((function(e){e.editing&&(e.editing.enable(),e.on("edit",(function(){updateButtonState()})))})),this.editMode=!0)}drawMap(e){this.loadMap(),e&&0!==Object.keys(e).length&&this.loadGeojson(e),document.getElementById("zoom-in").addEventListener("click",(function(){window.map.zoomIn()})),document.getElementById("zoom-out").addEventListener("click",(function(){window.map.zoomOut()})),document.getElementById("polygon").addEventListener("click",function(){this.disableActiveTool(),this.activeTool=new L.Draw.Polygon(window.map),this.activeTool.enable()}.bind(this)),document.getElementById("square").addEventListener("click",function(){this.disableActiveTool(),this.activeTool=new L.Draw.Rectangle(window.map),this.activeTool.enable()}.bind(this)),document.getElementById("circle").addEventListener("click",function(){this.disableActiveTool(),this.activeTool=new L.Draw.Circle(window.map),this.activeTool.enable()}.bind(this)),document.getElementById("trash").addEventListener("click",function(){this.deleteElement()}.bind(this)),window.map.on(L.Draw.Event.CREATED,function(e){this.drawElement(e)}.bind(this)),document.getElementById("edit").addEventListener("click",function(){this.disableActiveTool(),this.edit()}.bind(this))}fetchCitySuggestions(e,t,o){const n=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(`${e}, United States`)}&format=json&addressdetails=1&limit=10`;fetch(n).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{const n=e.map((e=>({name:e.display_name,lat:e.lat,lon:e.lon,onSelect:()=>this.drawTownCircle(e)})));createDropdown(n,o,t,"city-dropdown__link",!1)})).catch((e=>console.error("Error fetching cities:",e)))}drawTownCircle(e){const t=e.lat,o=e.lon;window.map.setView([t,o],9);const n=L.circle([t,o],{color:"blue",fillColor:"#30f",fillOpacity:.3,radius:40233.5,editable:!1}).addTo(window.map);window.nonEditableItems.addLayer(n),updateButtonState();const i={circle:n,name:e.display_name,radius:25};window.drawnCities.push(i);const a=n.getElement();a&&L.DomUtil.addClass(a,"custom-circle__searched")}showDrawnCities(e,t){const o=window.drawnCities.map((o=>({name:o.name,lat:o.circle.getLatLng().lat,lon:o.circle.getLatLng().lng,onSelect:()=>{window.map.setView(o.circle.getLatLng(),9),t.value=o.name,e.style.display="none",this.setupRadiusAdjustment(o)}})));createDropdown(o,e,t,"city-dropdown__link",!0),document.querySelector(".town-radius__dropdown").classList.add("hidden")}setupRadiusAdjustment(e){const t=document.querySelector(".town-dropdown__range");t.value=e.radius,t.max=50,t.min=0,t.style.display="block",t.oninput=function(){const o=parseInt(t.value),n=1609.34*o;e.circle.setRadius(n),e.radius=o}}},o=document.querySelector(".logout-btn"),n=document.getElementById("town-input"),i=document.getElementById("town-dropdown"),a=document.querySelector(".search-input__arrow");return window.drawnCities=[],e.authenticate(),o.addEventListener("click",(function(t){t.preventDefault(),e.logOut()})),n.addEventListener("focus",(()=>{disableTools(),document.querySelector(".town-radius__dropdown").classList.add("hidden")})),n.addEventListener("input",debounce((e=>{const o=e.target.value;if(""===o)return i.innerHTML="",void(i.style.display="none");t.fetchCitySuggestions(o,n,i)}),300)),a.addEventListener("click",(()=>{t.showDrawnCities(i,n)})),hideDropdownOnClick(i,n),{}})()));