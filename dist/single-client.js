!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("single-client",[],t):"object"==typeof exports?exports["single-client"]=t():e["single-client"]=t()}(this,(()=>(()=>{"use strict";class e{constructor(e,t){this.mapInstance=e,this.disableActiveTool=this.disableActiveTool.bind(this),this.createDropdown=this.createDropdown.bind(this),this.updateTooltipPosition=this.updateTooltipPosition.bind(this),this.deleteMode=null,this.editMode=!1,this.deleteElement=this.deleteElement.bind(this),this.drawElement=this.drawElement.bind(this),this.excludedBtn=document.querySelector(".option_button.exclude"),this.place=t,this.drawTownCircle=this.drawTownCircle.bind(this)}disableActiveTool(){this.mapInstance.activeTool&&(this.mapInstance.activeTool.disable(),this.mapInstance.activeTool=null),this.deleteMode&&(this.deleteMode.disable(),this.deleteMode=null),this.editMode&&(window.drawnItems.eachLayer((function(e){e.editing&&e.editing.disable()})),this.editMode=!1),document.querySelector(".town-radius__dropdown").classList.add("hidden")}deleteElement(){this.disableActiveTool(),this.deleteMode=new L.EditToolbar.Delete(window.map,{featureGroup:window.drawnItems}),this.deleteMode.enable(),window.drawnItems.eachLayer((e=>{e.on("click",(()=>{this.removeLayer(e)}))})),window.nonEditableItems.eachLayer((e=>{e.on("click",(()=>{this.removeLayer(e)}))}))}removeLayer(e){let t;console.log(e),window.drawnItems.hasLayer(e)&&window.drawnItems.removeLayer(e),window.nonEditableItems.hasLayer(e)&&window.nonEditableItems.removeLayer(e),window.map.removeLayer(e),window.drawnCities=window.drawnCities.filter((t=>t.circle!==e)),e._path?t=e.shapeId||e._path.getAttribute("shapeId"):e._layers&&Object.values(e._layers).forEach((e=>{e._path&&(t=e.shapeId||e._path.getAttribute("shapeId"))})),t&&document.querySelectorAll(`.state-row[shapeId="${t}"]`).forEach((e=>e.remove())),document.querySelector(".included-num__placeholder").textContent=document.querySelectorAll(".states_wrap.included .state-row").length,document.querySelector(".excluded-num__placeholder").textContent=document.querySelectorAll(".states_wrap.excluded .state-row").length,this.mapInstance.updateButtonState()}drawElement(e,t){const o=e.layer,n=`shape-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;window.drawnItems.addLayer(o),this.mapInstance.updateButtonState(),"polygon"===e.layerType?L.DomUtil.addClass(o._path,"custom-polygon"):"rectangle"===e.layerType?L.DomUtil.addClass(o._path,"custom-rectangle"):"circle"===e.layerType&&L.DomUtil.addClass(o._path,"custom-circle"),o._path.setAttribute("shapeId",n),this.excludedBtn.classList.contains("active")&&L.DomUtil.addClass(o._path,"excluded"),document.querySelectorAll(".tool-wrapper").forEach((function(e){e.classList.remove("active")})),o.shapeId=n,t.processLayer(o,n)}edit(){this.editMode?(window.drawnItems.eachLayer((function(e){e.editing&&e.editing.disable()})),this.editMode=!1):(window.drawnItems.eachLayer((function(e){e.editing&&(e.editing.enable(),e.on("edit",(function(){this.mapInstance.updateButtonState()})))})),this.editMode=!0)}drawTownCircle(e,t){const o=e.lat,n=e.lon,a=`shape-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;window.map.setView([o,n],9);const i=L.circle([o,n],{color:"blue",fillColor:"#30f",fillOpacity:.3,radius:40233.5,editable:!1}).addTo(window.map);window.nonEditableItems.addLayer(i),this.mapInstance.updateButtonState();const l={circle:i,name:e.display_name,radius:25};window.drawnCities.push(l);const s=i.getElement();s&&(L.DomUtil.addClass(s,"custom-circle__searched"),s.setAttribute("shapeId",a),this.excludedBtn.classList.contains("active")&&L.DomUtil.addClass(s,"excluded")),t.processLayer(i,a)}drawState(e,t){const o=`shape-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n=L.geoJSON(e,{style:{color:"blue",weight:2},onEachFeature:(e,t)=>{t instanceof L.Polygon&&(t.on("add",(()=>{L.DomUtil.addClass(t._path,"custom-polygon__searched"),t._path.setAttribute("shapeId",o),this.excludedBtn.classList.contains("active")&&L.DomUtil.addClass(t._path,"excluded")})),this.place.processLayer(t,o))}}).addTo(window.map);window.nonEditableItems.addLayer(n),t.updateButtonState();const a=n.getBounds();window.map.fitBounds(a)}createDropdown(e,t,o,n,a,i="#0c0b0e"){t.innerHTML="";const l=o.value.trim();if(l.length>0){const s=new RegExp(`(${l})`,"gi");e.forEach((e=>{const r=document.createElement("div");r.className="dropdown-item",r.classList.add(a),e.name.split(s).forEach((e=>{const t=document.createElement("span");e.toLowerCase()===l.toLowerCase()?(t.style.color=i,t.textContent=e):t.textContent=e,r.appendChild(t)})),r.classList.contains("zip-dropdown__link")&&r.addEventListener("click",(()=>{this.zipDraw(e)})),r.addEventListener("click",(()=>{e.onSelect(),n&&document.querySelector(".town-radius__dropdown").classList.toggle("hidden");const a=window.drawnCities.find((t=>t.name===e.name));a&&this.setupRadiusAdjustment(a),o.value=e.name,t.style.display="none",o.value=""})),t.appendChild(r)}))}else e.forEach((e=>{const a=document.createElement("div");a.className="dropdown-item",n&&a.classList.add("selected-city"),a.textContent=e.name,a.addEventListener("click",(()=>{e.onSelect(),a.classList.contains("selected-city")&&document.querySelector(".town-radius__dropdown").classList.toggle("hidden");const n=window.drawnCities.find((t=>t.name===e.name));n&&this.setupRadiusAdjustment(n),o.value=e.name,t.style.display="none",o.value=""})),t.appendChild(a)}));t.style.display=e.length>0?"block":"none"}setupRadiusAdjustment(e){const t=document.querySelector(".town-dropdown__range"),o=document.querySelector(".town-radius__tooltip");t.value=e.radius,t.max=50,t.min=0,o.textContent=`${e.radius} mi`,this.updateTooltipPosition(t,o),t.style.display="block",t.oninput=()=>{const n=parseInt(t.value),a=1609.34*n;e.circle.setRadius(a),e.radius=n,o.textContent=`${n} mi`,this.updateTooltipPosition(t,o),this.mapInstance.updateButtonState()}}updateTooltipPosition(e,t){const o=e.offsetWidth,n=t.offsetWidth,a=e.value/e.max*(o-20);t.style.left=a-n/2+33+"px"}zipDraw(e){const t=e.name.match(/^\d+/)?.[0],o=localStorage.getItem("authToken");t?fetch(`https://xrux-avyn-v7a8.n7d.xano.io/api:4o1s7k_j/get_zip_geojson?zipCode=${t}`,{method:"GET",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}}).then((e=>{if(!e.ok)throw new Error("Network response was not ok: "+e.statusText);return e.json()})).then((e=>{if(e.response&&e.response.result&&e.response.result.features&&e.response.result.features.length>0){const t=e.response.result.features[0].geometry.coordinates[0].map((e=>[e[1],e[0]])),o=L.polygon(t,{color:"blue",fillColor:"#3388ff",fillOpacity:.3}).addTo(map);o.getElement().classList.add("custom-polygon__searched"),this.excludedBtn.classList.contains("active")&&o.getElement().classList.add("excluded"),map.fitBounds(o.getBounds()),window.nonEditableItems.addLayer(o)}else console.error("No features found in the response data")})).catch((e=>{console.error("Error fetching ZIP code boundaries from Xano:",e)})):console.error("ZIP code not found in itemData name")}debounce(e,t){let o;return function(...n){o&&clearTimeout(o),o=setTimeout((()=>{e.apply(this,n)}),t)}}showNotification(e,t){const o=localStorage.getItem("notification")||e;if(o){const e=document.querySelector(".notification");e?(e.textContent=o,e.classList.remove("hidden"),localStorage.removeItem("notification"),t||setTimeout((()=>{e.classList.add("hidden")}),3500)):console.error("Notification element not found in DOM.")}}}class t{constructor(){this.activeTool=null,this.updateButtonState=this.updateButtonState.bind(this),this.tool=new e(this)}loadMap(){window.map=L.map("map",{zoomControl:!1}).setView([37.8,-96],4),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(window.map),window.drawnItems=new L.FeatureGroup,window.nonEditableItems=L.featureGroup().addTo(window.map),window.map.addLayer(window.drawnItems);const e=new L.Control.Draw({edit:!1,draw:{polygon:!1,rectangle:!1,circle:!1,marker:!1,polyline:!1,circlemarker:!1}});window.map.addControl(e)}loadGeojson(e){L.geoJSON(e,{onEachFeature:function(e,t){e.properties&&!1===e.properties.editable?window.nonEditableItems.addLayer(t):window.drawnItems.addLayer(t)}}).addTo(window.map)}drawMap(e,t,o){this.loadMap(),e&&0!==Object.keys(e).length&&this.loadGeojson(e),o&&o.length>0&&this.addPinsToMap(o),document.getElementById("zoom-in").addEventListener("click",(function(){window.map.zoomIn()})),document.getElementById("zoom-out").addEventListener("click",(function(){window.map.zoomOut()})),document.getElementById("polygon").addEventListener("click",function(){this.tool.disableActiveTool(),this.activeTool=new L.Draw.Polygon(window.map),this.activeTool.enable()}.bind(this)),document.getElementById("square").addEventListener("click",function(){this.tool.disableActiveTool(),this.activeTool=new L.Draw.Rectangle(window.map),this.activeTool.enable()}.bind(this)),document.getElementById("circle").addEventListener("click",function(){this.tool.disableActiveTool(),this.activeTool=new L.Draw.Circle(window.map),this.activeTool.enable()}.bind(this)),document.getElementById("trash").addEventListener("click",function(){this.tool.deleteElement()}.bind(this)),window.map.on(L.Draw.Event.CREATED,function(e){this.tool.drawElement(e,t)}.bind(this)),document.getElementById("edit").addEventListener("click",function(){this.tool.disableActiveTool(),this.tool.edit()}.bind(this))}addPinsToMap(e){let t=null;e.forEach(((e,o)=>{try{const n=JSON.parse(e.location.replace(/'/g,'"')),a=parseFloat(n.lan),i=parseFloat(n.lon),l=n.office_address;isNaN(a)||isNaN(i)||(L.marker([a,i]).addTo(window.map).bindPopup(`<strong>${l}</strong>`),0===o&&(t=[a,i]))}catch(t){console.error("Error parsing location:",e,t)}}))}fetchCitySuggestions(e,t,o,n){const a=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(`${e}, United States`)}&format=json&addressdetails=1&limit=10`;fetch(a).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{const a=e.map((e=>({name:e.display_name,lat:e.lat,lon:e.lon,onSelect:()=>this.tool.drawTownCircle(e,n)})));this.tool.createDropdown(a,o,t,"city-dropdown__link",!1)})).catch((e=>console.error("Error fetching cities:",e)))}showDrawnCities(e,t){const o=window.drawnCities.map((o=>({name:o.name,lat:o.circle.getLatLng().lat,lon:o.circle.getLatLng().lng,onSelect:()=>{window.map.setView(o.circle.getLatLng(),9),t.value=o.name,e.style.display="none",this.tool.setupRadiusAdjustment(o)}})));this.tool.createDropdown(o,e,t,"city-dropdown__link",!0),document.querySelector(".town-radius__dropdown").classList.add("hidden")}async searchZip(e,t){const o=e.value.trim();if(o.length<3)return t.innerHTML="",void(t.style.display="none");try{const n=await fetch(`https://nominatim.openstreetmap.org/search?postalcode=${o}&countrycodes=us&format=json&addressdetails=1`),a=(await n.json()).map((t=>({name:t.display_name,onSelect:()=>{e.value=t.display_name}})));this.tool.createDropdown(a,t,e,!1,"zip-dropdown__link")}catch(e){console.error("Error fetching location data:",e),t.style.display="none"}}hideDropdownOnClick(e,t){document.addEventListener("click",(o=>{e.contains(o.target)||o.target===t||o.target.classList.contains("search-input__arrow")||(e.style.display="none")}))}disableTools(){map&&map.dragging&&(document.querySelectorAll(".tool-wrapper").forEach((e=>{e.classList.remove("active")})),map.dragging.enable(),map.boxZoom.disable(),map.doubleClickZoom.enable())}updateButtonState(){const e=document.querySelector(".main-button.submit-selection"),t=Object.keys(window.drawnItems._layers).length,o=Object.keys(window.nonEditableItems._layers).length;t>0||o>0?e.classList.add("active"):e.classList.remove("active")}}class o{constructor(){this.displayedCities=new Set,this.pendingRequests=0,this.map=new t,this.tool=new e}processLayer(e,t){let o;if(this.tool.showNotification("List is Generating",!0),e instanceof L.Polygon||e instanceof L.Rectangle){const t=e.getLatLngs()[0],n=`${Math.min(...t.map((e=>e.lat)))},${Math.min(...t.map((e=>e.lng)))},${Math.max(...t.map((e=>e.lat)))},${Math.max(...t.map((e=>e.lng)))}`;o=`\n                [out:json];\n                (\n                    node["place"~"city|town|village|hamlet|locality"](${n});\n                    way["place"~"city|town|village|hamlet|locality"](${n});\n                    relation["place"~"city|town|village|hamlet|locality"](${n});\n                );\n                out body;`}else if(e instanceof L.Circle){const t=e.getLatLng(),n=e.getRadius();o=`\n                [out:json];\n                (\n                    node["place"~"city|town|village|hamlet|locality"](around:${n}, ${t.lat}, ${t.lng});\n                    way["place"~"city|town|village|hamlet|locality"](around:${n}, ${t.lat}, ${t.lng});\n                    relation["place"~"city|town|village|hamlet|locality"](around:${n}, ${t.lat}, ${t.lng});\n                );\n                out body;`}else{if(!(e instanceof L.GeoJSON))return void console.warn("Unsupported layer type. Only polygon, rectangle, circle, and geoJSON are supported.");{const t=e.getBounds(),n=`${t.getSouth()},${t.getWest()},${t.getNorth()},${t.getEast()}`;o=`\n                [out:json];\n                (\n                    node["place"~"city|town|village|hamlet|locality"](${n});\n                    way["place"~"city|town|village|hamlet|locality"](${n});\n                    relation["place"~"city|town|village|hamlet|locality"](${n});\n                );\n                out body;`}}this.pendingRequests++,this.sendOverpassQuery(o,t)}sendOverpassQuery(e,t){fetch("https://overpass-api.de/api/interpreter",{method:"POST",body:e}).then((e=>e.json())).then((e=>{const o=e.elements.filter((e=>e.tags&&"relation"===e.type&&e.tags.name)),n=document.querySelector(".option_button.exclude"),a=document.querySelector(".states_wrap."+(n.classList.contains("active")?"excluded":"included"));this.listPlaces(a,o,t)})).catch((e=>{console.error("Error querying Overpass API:",e)}))}listPlaces(e,t,o){e&&t.length>0?(t.forEach((t=>{if(!t.tags.wikipedia)return;const n=t.tags.name;let a=t.tags.wikipedia.split(", ").length>1?t.tags.wikipedia.split(", ")[1]:t.tags.wikipedia.split(", ")[0].replaceAll("en:","");const i=document.createElement("div");i.classList.add("state-row"),i.setAttribute("shapeId",o);const l=document.createElement("div");l.classList.add("state-name-text"),l.textContent=n+", "+a;const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("xmlns","http://www.w3.org/2000/svg"),s.setAttribute("width","100%"),s.setAttribute("viewBox","0 0 12 18"),s.setAttribute("fill","none"),s.classList.add("toggle-arrow-svg"),s.innerHTML='\n                        <path d="M11.7578 12.393L7.67002 8.30518L6.96489 9.01031L10.4374 12.4828H0V13.4806H10.4374L6.96489 16.9531L7.67002 17.6582L11.7578 13.5704C12.0805 13.2478 12.0805 12.7189 11.7578 12.393Z" fill="currentColor"></path>\n                        <path d="M0.242183 5.60752L4.32998 9.69531L5.03511 8.99018L1.56265 5.51771L12 5.51771V4.51988L1.56265 4.51988L5.03511 1.04741L4.32998 0.342276L0.242183 4.43007C-0.0804501 4.75271 -0.0804501 5.28156 0.242183 5.60752Z" fill="currentColor"></path>\n                    ',i.appendChild(l),i.appendChild(s),e.appendChild(i)})),document.querySelector(".included-num__placeholder").textContent=document.querySelectorAll(".states_wrap.included .state-row").length,document.querySelector(".excluded-num__placeholder").textContent=document.querySelectorAll(".states_wrap.excluded .state-row").length,document.querySelector(".excluded-included__section").classList.remove("hidden"),document.querySelector(".notification").classList.add("hidden")):console.log("No cities found in this area.")}searchIncludedExcludedPlaces(e,t){const o=document.querySelector(e),n=document.querySelector(t);o&&n?o.addEventListener("input",(()=>{const e=o.value.toLowerCase();n.querySelectorAll(".state-row").forEach((t=>{const o=t.querySelector(".state-name-text")?.textContent.toLowerCase()||"";t.style.display=o.includes(e)?"flex":"none"}))})):console.warn(`Elements not found for selectors: ${e}, ${t}`)}}let n=new class{constructor(e){this.authToken=localStorage.getItem("authToken"),this.colorRandomizer=this.colorRandomizer.bind(this),this.removeOffice=this.removeOffice.bind(this),this.map=new t,this.place=new o,this.tool=e}loadClients(e,t,o,n,a){const i=document.querySelector("#clients-table tbody"),l=document.querySelector(".clients-table__range");i.style.opacity="40%",document.querySelectorAll(".pagination-arrow").forEach((e=>{e.classList.add("disabled")}));let s=`https://xrux-avyn-v7a8.n7d.xano.io/api:4o1s7k_j/clients?page=${t}&per_page=${o}&offset=${n}`;a&&(s+=`&search=${encodeURIComponent(a)}`),fetch(s,{method:"GET",headers:{Authorization:`Bearer ${this.authToken}`,"Content-Type":"application/json"}}).then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()})).then((n=>{e&&(0===n.clients.itemsTotal&&document.querySelector(".add-new-client").click(),document.querySelectorAll(".clients-number").forEach((e=>{e.textContent=n.clients.itemsTotal})),document.querySelector(".clients-table__loader").remove()),null===n.clients.nextPage?document.querySelector(".pagination-arrow.right").classList.add("disabled"):document.querySelector(".pagination-arrow.right").classList.remove("disabled"),null===n.clients.prevPage?document.querySelector(".pagination-arrow.left").classList.add("disabled"):document.querySelector(".pagination-arrow.left").classList.remove("disabled");let a="";0===n.clients.items.length?a='\n        <tr>\n          <td colspan="8" class="no-data-message">No data</td>\n        </tr>':n.clients.items.forEach((e=>{a+=`\n          <tr>\n            <td class="dark"><a href="/?client_id=${e.id}" class="client-table__link">${e.image?`<img class="client-image" src="${e.image.url}" alt="Client image">`:`<div style="background-color: ${this.colorRandomizer()};" class="fullname-capital">${e.company_name.slice(0,1).toUpperCase()}</div>`}${e.company_name}</a></td>\n            <td><a href="${e.website}" target="_blank" class="website-link">${e.website}</a></td>\n            <td><a href="mailto:${e.email}" class="email-link">${e.email}</a></td>\n            <td class="light">${e.phone_number}</td>\n            <td class="light">${new Date(e.created_at).toLocaleDateString()}</td>\n            <td><a href="/client?client_id=${e.id}"><img class="edit-client__btn" src="https://cdn.prod.website-files.com/66eab8d4420be36698ed221a/6706654e169e0a1ab9a12e73_pencil-icon.svg"></a></td>\n          </tr>`})),i.innerHTML=a,i.style.opacity="100%",document.querySelector(".clients-section").style.opacity="1";const s=(t-1)*o+1,r=Math.min(s+n.clients.items.length-1,n.clients.itemsTotal);l.textContent=`${s}-${r}`})).catch((e=>{console.error("Error fetching clients:",e)}))}searchNavClients(e,t){e.forEach((e=>{const o=e.querySelector(".client-link__info").innerText.toLowerCase();""===t||o.includes(t)?e.style.display="flex":e.style.display="none"}))}colorRandomizer(){let e=["#CBE4F9","#CDF5F6","#EFF9DA","#F9EBDF","#F9D8D6","#D6CDEA"];return e[Math.floor(Math.random()*e.length)]}loadClientHomepage(e,t){this.authToken?fetch(t,{method:"GET",headers:{Authorization:`Bearer ${this.authToken}`}}).then((e=>e.json())).then((t=>{const o=document.querySelector(".nav-clients.no-clients"),n=document.querySelector(".nav-clients.existing");if(null===t.geojson_map&&Array.isArray(t.homepage_clients)&&0===t.homepage_clients.length)o.style.display="flex",n.style.display="none";else{o.style.display="none",n.style.display="flex";const a=e?t.homepage_clients.find((t=>t.id===parseInt(e))):t.homepage_clients[0];this.map.drawMap(JSON.parse(a.geojson_map.map),this.place,t.homepage_clients[0].client_offices);const i=document.querySelector(".client-nav__name"),l=document.querySelector(".client-nav__image");document.querySelector(".clients-number").textContent=t.homepage_clients.length;const s=document.querySelector(".client-link.active .client-nav__image"),r=document.querySelector(".client-link.active .client-link__info");i.textContent=a.company_name,l.src=a.image.url,s.src=a.image.url,r.innerHTML=`${a.company_name}<br>`,n.classList.remove("hidden");const d=document.querySelector(".clients-wrapper");d.innerHTML="",t.homepage_clients.forEach((o=>{if(e&&o.id==e||!e&&o.id==t.homepage_clients[0].id)return;const n=document.createElement("a");n.classList.add("client-link","not-selected"),n.setAttribute("client-id",o.id),n.href="?client_id="+o.id,n.innerHTML=`\n  ${o.image?`<img src="${o.image.url}" loading="lazy" alt="" class="client-nav__image">`:`<div class="client-avatar" style="background-color: ${o.colorRandomizer()} ;">${o.company_name.charAt(0).toUpperCase()}</div>`}\n  <p class="client-link__info">\n    ${o.company_name}\n  </p>\n`,d.appendChild(n)}))}})).catch((e=>{console.error("Error fetching data:",e)})):console.error("authToken not found in local storage")}modalNextStep(e){document.querySelectorAll(".modal-dropdown").forEach((e=>{e.querySelector(".modal-dropdown__text").classList.remove("active"),e.querySelector(".modal-dropdown__arrow").classList.remove("active")}));const t=document.querySelector(".modal-dropdown.factors");t&&(t.querySelector(".modal-dropdown__text").classList.add("active"),t.querySelector(".modal-dropdown__arrow").classList.add("active")),2===e&&(document.querySelector(".new-client__modal").scrollTop=0)}gatherClientData(e){e.company_name=document.getElementById("company").value,e.email=document.getElementById("email").value,e.website=document.getElementById("website").value,e.phone_number=document.getElementById("phone-number").value,e.company_office_adr=Array.from(document.querySelectorAll(".company-office-address")).map((e=>e.value)).filter(Boolean)}addNewClient(e){const t=localStorage.getItem("authToken"),o={company_name:e.company_name,email:e.email,website:e.website,phone_number:e.phone_number,population_factor:parseFloat(document.getElementById("population").value)||0,avg_household_income_factor:parseFloat(document.getElementById("avg-income").value)||0,single_family_homes_factor:parseFloat(document.getElementById("num-homes").value)||0,avg_home_value_factor:parseFloat(document.getElementById("avg-home-value").value)||0,distance_from_hq_factor:parseFloat(document.getElementById("distance-hq").value)||0,client_img:e.client_img||null};fetch("https://xrux-avyn-v7a8.n7d.xano.io/api:4o1s7k_j/clients",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(o)}).then((e=>{if(!e.ok)throw new Error("Failed to add client");return e.json()})).then((e=>{const o=e.id,n=document.querySelectorAll(".form-input.company-office-address"),a={client_id:o,location:"",locations:Array.from(n).map((e=>{const t=e.value.trim().replaceAll(", United States",""),o=e.getAttribute("data-latitude"),n=e.getAttribute("data-longitude");return t&&o&&n?`{'office_address': '${t}', 'lan': '${o}', 'lon': '${n}'}`:null})).filter((e=>e))};return fetch("https://xrux-avyn-v7a8.n7d.xano.io/api:4o1s7k_j/new_offices",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(a)})})).then((e=>{if(!e.ok)throw new Error("Failed to add office addresses");return e.json()})).then((e=>{location.reload(),localStorage.setItem("notification","Client created successfully")})).catch((e=>{console.error("Error:",e)}))}updateModalContent(e){document.querySelector(".modal-form__wrapper.first-step").classList.add("hidden"),document.querySelector(".modal-form__wrapper.second-step").classList.remove("hidden"),e.target.classList.remove("second-step","active"),e.target.classList.add("add-client"),e.target.textContent="Add new Client"}validateForm(e,t){const o=Array.from(e.querySelectorAll(".form-input[required]")).every((e=>e.value&&("email"!==e.type||this.validateEmail(e.value))));t.classList.toggle("active",o)}validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}addNewAddressField(e,t){e++;const o=t.querySelectorAll(".form-input__wrapper"),n=o[o.length-1].cloneNode(!0),a=n.querySelector("input");a.value="",a.id=`field-address-${e}`,a.name=`address-${e}`,a.removeAttribute("required");const i=n.querySelector("label");i&&(i.textContent=`Company Office Address ${e}`,i.setAttribute("for",`field-address-${e}`));const l=n.querySelector(".red-star");return l&&l.remove(),t.appendChild(n),a.addEventListener("input",this.tool.debounce((e=>{this.getAddressSuggestion(e.target)}),300)),e}validateSecondStepInput(){let e=!1,t=!1,o=!1,n=0,a=0;[document.getElementById("population"),document.getElementById("avg-income"),document.getElementById("num-homes"),document.getElementById("avg-home-value"),document.getElementById("distance-hq")].forEach((i=>{const l=parseFloat(i.value);1===l?(a++,t=!0):0===l?(n++,o=!0):l>0&&l<1&&(e=!0)})),t&&o&&!(a>2||n>2)&&e?document.querySelector(".add-client").classList.add("active"):document.querySelector(".add-client").classList.remove("active")}uploadClientImage(e,t,o){if(t.innerHTML="",e.length>0&&(e[0].type.startsWith("image/")||"image/svg+xml"===e[0].type)){const n=new FileReader;n.onloadend=()=>{o.client_img=n.result;const e=document.createElement("img");e.src=o.client_img,t.appendChild(e)},n.readAsDataURL(e[0])}}loadSingleClient(e,t){fetch(`https://xrux-avyn-v7a8.n7d.xano.io/api:4o1s7k_j/clients/${e}`,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}).then((e=>{if(!e.ok)throw new Error("Failed to fetch client data");return e.json()})).then((e=>{const t=document.getElementById("profile-company"),o=document.getElementById("profile-email"),n=document.getElementById("profile-website"),a=document.getElementById("profile-phone"),i=document.querySelector(".client_name_text"),{client_offices:l}=e,s=document.getElementById("client-img");t.value=e.company_name,o.value=e.email,n.value=e.website,a.value=e.phone_number,i.textContent=e.company_name,this.populateClientOffices(l),s.onload=()=>{document.getElementById("single-client-section").style.opacity="1",document.querySelector(".clients-table__loader").remove()},s.src=e.image.url}))}populateClientOffices(e){const t=document.querySelector(".office-address-wrap"),o=document.querySelector(".add-office_wrapper");document.querySelectorAll(".office-address-wrap")[0].remove(),e.forEach((e=>{const n=JSON.parse(e.location.replace(/'/g,'"')).office_address,a=t.cloneNode(!0);a.querySelector("input").value=n;const i=a.querySelector(".remove-office");i.setAttribute("data-office-id",e.id),i.addEventListener("click",(e=>{const t=i.getAttribute("data-office-id");this.removeOffice(t,a)})),o.parentNode.insertBefore(a,o)}))}removeOffice(e,t){console.log("Attempting to delete office with ID:",e);const o=localStorage.getItem("authToken");o?fetch(`https://xrux-avyn-v7a8.n7d.xano.io/api:4o1s7k_j/offices/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}}).then((e=>{if(!e.ok)throw new Error("Failed to delete office");return e.json()})).then((e=>{t.remove()})).catch((e=>{console.error("Error deleting office:",e)})):console.error("No auth token found in localStorage")}addNewOfficeField(e){const t=document.querySelector(".add-office_wrapper"),o=document.createElement("div");o.classList.add("form-input__wrapper");const n=document.createElement("label");n.classList.add("client-input-label"),n.textContent="Company Office Address",o.appendChild(n);const a=document.createElement("input");a.classList.add("full_name_input","w-input"),a.setAttribute("type","text"),a.setAttribute("maxlength","256"),a.setAttribute("name","field-2"),a.setAttribute("data-name","Field 2"),a.setAttribute("placeholder",""),a.required=!0,a.addEventListener("input",e.debounce((e=>{this.getAddressSuggestion(e.target)}),300)),o.appendChild(a);const i=document.createElement("div");i.classList.add("client-address__dropdown-suggestion"),o.appendChild(i),t.parentNode.insertBefore(o,t)}getAddressSuggestion(e){let t=e.value;const o=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(`${t}, United States`)}&format=json&addressdetails=1&limit=3`;fetch(o).then((e=>e.json())).then((t=>{const o=e.closest(".form-input__wrapper").querySelector(".client-address__dropdown-suggestion");o.innerHTML="",t&&t.length>0&&t.forEach((t=>{const n=document.createElement("div");n.classList.add("dropdown-item","client-address__item"),n.innerHTML=`<span>${t.display_name}</span>`,n.addEventListener("click",(()=>{e.value=t.display_name,o.innerHTML="",e.dataset.latitude=t.lat,e.dataset.longitude=t.lon,e.lat=t.lat,e.lon=t.lon})),o.appendChild(n)}))})).catch((e=>{console.error("Error fetching address data:",e)}))}deleteClient(){const e=new URLSearchParams(window.location.search).get("client_id"),t=localStorage.getItem("authToken");e&&t?fetch(`https://xrux-avyn-v7a8.n7d.xano.io/api:4o1s7k_j/clients/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}).then((e=>{if(!e.ok)throw new Error("Failed to delete client");return e.json()})).then((()=>{localStorage.setItem("notification","Client deleted successfully"),window.location.href="/clients"})).catch((e=>{console.error("Error:",e)})):console.error("Missing client_id or authToken")}},a=new class{authenticate(e="/",t="/login"){const o=localStorage.getItem("authToken");o?fetch("https://xrux-avyn-v7a8.n7d.xano.io/api:7eX5OyVa/auth/me",{method:"GET",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}}).then((e=>e.json())).then((o=>{if("ERROR_CODE_UNAUTHORIZED"===o.code)localStorage.removeItem("authToken"),window.location.pathname!==t&&(window.location.href=t);else{if("/clients"===window.location.pathname||"/client"===window.location.pathname)return;window.location.pathname!==e&&(window.location.href=e)}})).catch((e=>{console.error("Error:",e)})):window.location.pathname!==t&&(window.location.href=t)}logIn(e){fetch("https://xrux-avyn-v7a8.n7d.xano.io/api:7eX5OyVa/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{if(e.authToken)localStorage.setItem("authToken",e.authToken),0===e.clients_length?window.location.href="/clients":window.location.href="/";else{const e=document.querySelector(".error-message"),t=document.querySelectorAll(".login-input");e.classList.remove("hidden"),t.forEach((e=>{e.classList.add("invalid")}))}})).catch((e=>{console.error("Error:",e)}))}logOut(){localStorage.removeItem("authToken"),window.location.href="/login"}toggleUserPassVisibility(e,t,o){"password"===e.type?(e.type="text",t.style.display="block",o.style.display="none"):(e.type="password",t.style.display="none",o.style.display="block")}},i=new e;const l=document.querySelector(".logout-btn"),s=document.querySelector(".cancel-client-btn"),r=document.querySelector(".delete_client_button"),d=document.querySelector(".add_text-link"),c=new URLSearchParams(window.location.search).get("client_id"),u=localStorage.getItem("authToken");return document.addEventListener("DOMContentLoaded",(function(){n.loadSingleClient(c,u)})),a.authenticate(),l.addEventListener("click",(function(e){e.preventDefault(),a.logOut()})),s.addEventListener("click",(function(e){e.preventDefault(),location.reload()})),r.addEventListener("click",(function(e){e.preventDefault(),n.deleteClient()})),d.addEventListener("click",(e=>{e.preventDefault(),n.addNewOfficeField(i)})),{}})()));